<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Integrating Drupal and Node.js</title>

    <meta name="description" content="3 Case studies of How we intregrated Drupal and Node.js">
    <meta name="author" content="Elliott Foster">
    <meta name="author" content="Michal Minecki">
    <meta name="author" content="Ian Carrico">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/print.css" type="text/css" media="print">

    <link rel="stylesheet" href="lib/github.css">
    <link rel="stylesheet" href="lib/carousel.css">
  </head>

  <body>

    <div class="reveal">

      <!-- Used to fade in a background when a specific slide state is reached -->
      <div class="state-background"></div>

      <!-- Fork me on GitHub ribbon -->
      <a href="https://github.com/fourkitchens/Magnetic-Poetry" id="fork-me" class="image" target="_blank"><img src="https://s3.amazonaws.com/github/ribbons/forkme_left_green_007200.png" alt="Fork me on GitHub"></a>

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section>
          <h1>Integrating node.js</h1>
          <h3 class="inverted">for real-time awesomesauce</h3>
          <h4>i.e. 4k â™¥'s node.js</h4>
          <script>
            // Delicously hacky. Look away.
            if( navigator.userAgent.match( /(iPhone|iPad|iPod|Android)/i ) ) document.write( '<p style="color: rgba(0,0,0,0.3); text-shadow: none;">('+'Tap to navigate'+')</p>' );
          </script>
        </section>

        <section>
          <h2>Michal Minecki</h2>
          <ul class="networks">
            <li class="twitter"><a href="https://twitter.com/mirzu">@mirzu</a></li>
            <li class="drupal"><a href="http://drupal.org/user/7710">drupal.org/user/7710</a></li>
            <li class="github"><a href="https://github.com/mirzu">github.com/mirzu</a></li>
          </ul>
        </section>

        <section>
          <h2>What we'll go over.</h2>
          <ul>
            <li>Node.js Basics</li>
            <li>Three Quick Case studies.<ul>
              <li>Pubsub Stuff</li>
              <li>Drupo Poetry</li>
              <li>Live Video Commenting</li>
            </ul></li>
            <li>Other integration options</li>
          </ul>
        </section>
        <section>
          <h2>What is Node.js?</h2>
        </section>
        <section>
          <h4>What is Node.js?</h4>
          <section>
            <h2>From Nodejs.org</h2>

            <blockquote>
              Node.js is a platform built on Chrome's JavaScript runtime for easily building fast, scalable network applications. Node.js uses an event-driven, non-blocking I/O model that makes it lightweight and efficient, perfect for data-intensive real-time applications that run across distributed devices.
            </blockquote>
          </section>

          <section data-markdown>
            <h1> WAT?</h1>
          </section>
          <section data-markdown>
            <blockquote>
              Node.js is a platform built on Chrome's JavaScript runtime [...]
            </blockquote>
            <p>&nbsp</p>
            <ul>
              <li class='fragment'>Chrome's JavaScript runtime is called V8, it's one of the reasons
              Chrome is considered so fast.</li>
             <li class='fragment'>node.js leverages V8's speed on the server!</li>
          </section>
          <section data-markdown>
            <blockquote>
              [...] easily building fast, scalable network applications.
            </blockquote>
            <p>&nbsp</p>
            <ul>
              <li class='fragment'> Node wants to act as a message passer (more on this later).</li>
            </ul>
          </section>
          <section data-markdown>
            <blockquote>
              Node.js uses an event-driven, non-blocking I/O model [...]
            </blockquote>
            <p>&nbsp</p>

            <ul>
              <li class='fragment'>Only one thing gets executed at a time, but libraries allow I/O
              or other intensive tasks to be executed asynchronously so the
              script doesn't need to wait for them to finish.</li>
            </ul>
          </section>
          <section>
            <h2>What Node like to work with?</h2>
            <ul>
              <li class='fragment'>Javascript without a browser.</li>
              <li class='fragment'>Runs as a server.</li>
              <li class='fragment'>Ships with basic libraries.</li>
              <li class='fragment'>Has a built in package manager.</li>
              <li class='fragment'></li>
            </ul>
          </section>
          <section>
            <h2>What makes it awesome to work with?</h2>
            <ul>
              <li class='fragment'>Packages, lots of them very easy to manage.</li>
              <li class='fragment'>Same language as in browser.</li>
              <li class='fragment'>Large number of PAAS hosting options.</li>
              <li class='fragment'>Large and fast growing community</li>
              <li class='fragment'>It's Javascript.</li>
            </ul>
          </section>
          <section data-markdown>
            <h2>What could I do without?</h2>
            <ul>
              <li class='fragment'>Async programing can be difficult to organize. (Callback Hell)</li>
              <li class='fragment'>Fast moving project lots of updates</li>
              <li class='fragment'>Error handling is really important, server crash means whole app stops responding.</li>
              <li class='fragment'>It's Javascript.</li>
            </ul>
          </section>
          <section>
            <h2>If it's so great why don't you marry it?</h2>
          <section>
            <h2>Drupal Kicks Ass</h2>
            <ul>
              <li class='fragment'>Fully backed features. - Node has libraries, drupal has solutions.</li>
              <li class='fragment'>Fully baked systems - Users, content, taxonomies.</li>
              <li class='fragment'>Fully bakced admin interface.</li>
              <li class='fragment'>Allows a great deal of flexibility for site builders.</li>
            </ul>
          </section>
          </section>
          <section>
            <h2>Why does Drupal well with node?</h2>
            <ul>
              <li>Feeds is pretty awesome at injesting data</li>
              <li>Lots of options for authenticaiton</li>
              <li>Easy to connect to using services module</li>
              <li>Easy to create custom endpoints in services</li>
            </ul>
          </section>
        </section>
        <section>
          <h1>Case Studies</h1>
        </section>
        <section>
          <h2>PubSubHubbub</h2>
          <h2>Hub</h2>
          <img src="http://i.imgur.com/g5GET.jpg" />
        </section>
        <section>
          <small>PubSub</small>
          <section>
            <h3>SRSLY, what's up with that crazy name?</h3>

            <ul>
              <li>RSS feeds don't necessarily get updated very frequently.</li>
              <li>As a provider it's undesirable to have consumers generating load when there's no new content.</li>
              <li>The solution: PubSub!</li>
              <li>Notifies subscribers when new content comes in, so they don't need to keep checking.</li>
            </ul>
          </section>
          <section>
            <h3>The need</h3>

            <ul>
              <li>About 100+ Drupal sites.</li>
              <li>Need to consume about 300+ data feeds that didn't natively support PubSub.</li>
            </ul>
          </section>
          <section>
            <h3>Wait, Drupal supports polling feeds, right?</h3>
            <ul>
              <li class="fragment">Yes! And in fact it's pretty good at it.</li>
              <li class="fragment">BUT, these feeds were time sensitive.</li>
              <li class="fragment">It was unrealistic to have a Drupal process continuously running to do the polling.</li>
            </ul>
          </section>
          <section>
            <h3>Ok, so what'd you do?</h3>
            <ul>
              <li>Augmented the RSS feeds with node.js to support PubSub.</li>
              <li>Node took care of the polling and implemented the PubSub protocol so the feeds module would "just work".</li>
              <li>Deployed the node code in the joyent cloud, separate from the Drupal installations.</li>
            </ul>
          </section>
          <section>
            <h3>The result</h3>
            <ul>
              <li>Almost indiscernible load on the node server.</li>
              <li>Load is only generated on the Drupal servers when there's actually work to do.</li>
              <li>Drupal is able to transparently subscribe to the node hub with the feeds module (i.e. Drupal devs don't need to know or care how the node code is working as long as it's up).</li>
            </ul>
          </section>
        </section>
        <section>
          <h3>PubSub questions?</h3>
          <img src="https://github.com/images/error/angry_unicorn.png" />
        </section>
        <section>
          <h1>Drupal Poetry</h1>
          <h3 class="inverted">Responsive Application Development with Drupal and Backbone</h3>
        </section>
        <section>
          <section>
            <h2>Drupal Poetry</h2>
            One codebase to rule them all.
            <p><video src="video/drupo.m4v" width="720"  controls></p>
            <p><a href="video/drupo.m4v">video</a>
          </section>
          <section>
            <h2>Desktop</h2>
            <img src="img/desktop.png" />
          </section>
          <section>
            <h2>Tablet</h2>
            <img src="img/tablet.png" />
          </section>
          <section>
            <h2>Mobile</h2>
            <img src="img/mobile-listing.png" />
            <img src="img/mobile.png" />
          </section>
          <section>
            <h2>Drupal Admin</h2>
            <img src="img/drupal-admin.png" />
          </section>
        </section>
        <section>
          <h2>Why We Built it</h2>
          <ul>
            <li class="fragment">Have fun. (Built on 20% time)</li>
            <li class="fragment">Work with hipster technolgies.</li>
            <li class="fragment">See if Responsive works for Applications.</li>
          </ul>
        </section>
        <section>
          <section>
            <h2>Technologies</h2>
            <img src="img/code-breakdown.png" />
          </section>
          <section>
            <h2>Front-end JS:<h2>
            <h3>Backbone.js and Underscore</h3>
            <ul>
              <li><a href="http://backbonejs.org/">Backbone</a></li>
              <ul>
                <li>Lightweight framework for creating web applications</li>
                <li>Almost a MVC</li>
              </ul>
              <li><a href="http://documentcloud.github.com/underscore/">Underscore</a></li>
              <ul>
                <li>Set of utility functions that make working with JavaScript less insane.</li>
              </ul>
            </ul>
          </section>
          <section>
            <h2>require.js</h2>
            <ul>
              <li><a href="http://requirejs.org/">requirejs.org</a></li>
              <li>JavaScript file and module loader.</li>
              <li>Simplifies code reuse on client and server.</li>
              <li>Includes build/optimization tools.</li>
            </ul>
          </section>
          <section>
            <h2>Node.js</h2>
            <ul>
              <li><a href="http://nodejs.org/">nodejs.org</a></li>
              <li>Server side JavaScript platform.</li>
              <li>Built on Google Chrome's V8 JavaScript engine.</li>
              <li>Event-driven, non-blocking.</li>
            </ul>
          </section>
          <section>
            <h2>MongoDB</h2>
            <ul>
              <li><a href="http://www.mongodb.org/">mongodb.org</a></li>
              <li>NoSQL database/document store.</li>
              <li>Objects stored in BSON (very similar to JSON).</li>
              <li>Schemaless design.</li>
            </ul>
          </section>
        </section>
        <section class="architecture">
          <section>
            <h2>Architecture</h2>
            <img src="img/architecture.png" />
          </section>
        </section>
        <section>
          <h2>Poem life cycle</h2>
          <section>
            <h3>Fresh Page</h3>
            <ul>
              <li class="fragment">Nginx serves the HTML.</li>
              <li class="fragment">Backbone.js requests the cached taxonomy terms to populate the word libraries.</li>
              <li class="fragment">User starts to put words in the work area.</li>
              <li class="fragment">All changes are stored in the browser memory.</li>
              <li class="fragment">User clicks share.</li>
            </ul>
          </section>
          <section>
            <h3>Saving a Poem</h3>
            <ul>
              <li class="fragment">Poem is saved.</li>
              <li class="fragment">If there is no Session: Session is lazy created by Node.js and stored in Browser Local storage.</li>
              <li class="fragment">Poem is saved as a json object directly in MongoDB by Node.js.</li>
              <li class="fragment">Permalink is created by Node.js from the MongoDB hash and sent to browser.</li>
              <li class="fragment">Reference to Poem is asynchronously saved in Drupal using services. (Send some other data with it but we feel bad about that.)</li>
              <li class="fragment">Drupal responds with NID.</li>
              <li class="fragment">Node.js Updates the MongoDB document with the the NID.</li>
            </ul>
          </section>  
          <section>
            <h3>Fun stuff.</h3>
            <ul>
              <li class="fragment">User is encouraged to login with Twitter OAuth and/or tweet it.</li>
              <li class="fragment">If they don't login and don't clear cache they can come back and edit.</li>
              <li class="fragment"><em>Now it gets interesting.</em></li>
              <li class="fragment">Moving the words saves the new poem in MongoDB. <em>Autosave!</em></li>
              <li class="fragment">Same anon user can edit poems without login.</li>
              <li class="fragment">Users can "fork" poems. Use someone else's poem as a starting point.</li>
            </ul> 
          </section>  
        </section> 
        <section>
          <h3>Autosave Workflow</h3>
          <section>
            <h4>Actual</h4>
            <img src="img/autosave-actual.png" />
          </section>
          <section>
            <h4>Better</h4>
            <img src="img/autosave-ideal.png" />
          </section>
        </section>
        
        <section class="architecture">
          <section>
            <p class='presenter'>questions</p>
            <h2>Drupo Questions?</h2>
            <img src="img/architecture.png" />
          </section>
        </section>
        <section>
          <section>
            <h2>EEERRRRR MMERRRRE GERD VERDERO KERMENTING</h2>
            <img src="img/kermit.jpg" width="250px" height="350px">
          </section>
        </section>
        <section>
          <h2>What we did</h2>
          <section>
            <h3>The Need</h3>
            <ul>
              <li>A live event with viewers across the globe</li>
              <li>Needed live-feed of all participants thoughts to be shared</li>
              <li>As we were using a live video, we could not have any page refreshing</li>
            </ul>
            <br><br>
            <p class="fragment">Why not Drupal's AJAX?<br>It's slow, and resource intensive</p>
          </section>
          <section>
            <h3>The Solution</h3>
            <ol>
              <li class="fragment">Had a second server that was running Node.js with socket.io.</li>
              <li class="fragment">Each user had a Drupal form that would submit a discussion node with their thoughts, thus saving the new node in Drupal.</li>
              <li class="fragment">The node.js server pinged the Drupal server every 10-15 seconds and grabbed a JSON object with all new discussions</li>
              <li class="fragment">Node.js would then push out all the new discussions to all users with socket.io, and update any formatting</li>
              <li class="fragment">The client would receive the new nodes in a JSON object, display it on their feed.</li>
          </section>
          <section>
            <h3>The Effect</h3>
            <ul>
              <li class="fragment">Real-time data was easily shared for every user.</li>
              <li class="fragment">Minimal Drupal interface, while still keeping all data within Drupal.</li>
              <li class="fragment">Single page for all video, discussions, etc. to allow all users to fully interact.</li>
              <li class="fragment">All pages work fully on a variety of devices.</li>
            </ul>
          </section>
          <section>
            <h3>The Nerdy Stuff</h3>
             <img src="img/frontiers.png"> 
          </section>
          <section>
            <h3>The Future</h3>
            <ul>
              <li class="fragment">Link the video timeline with comments, so that the comments are displayed when they were made during the video when it's replayed. </li>
              <li class="fragment">Include some sort of voting API work, so that we can have live voting an analytics with the discussions</li>
              <li class="fragment">Move the handing of new comments and discussion to Node.js, within reason.</li>
            </ul>
          </section>
        </section>
        <section>
          <h2>Drupal Module</h2>
          <ul>
            <li>Looks like a winner.</li>
            <li>Appears well written and useful.</li>
            <li>Opinionated and attempts to be comprehnsive</li>
            <li>Didn't use it because we wanted low code debt.</li>
          </ul>
        </section>

        <section>
          <h3>Fork us on GitHub!</h3>

          <img src="http://media-cache-ec6.pinterest.com/upload/226305949995949276_FA9IWBem_b.jpg" />
          <br />
          <ul>
            <li><a href="https://github.com/elliotttf/PubHub">PubHub</a></li>
            <li><a href="https://github.com/fourkitchens/Magnetic-Poetry">Drupal Poetry</a></li>
          </ul>
        </section>

        <section>
          <h1>Thanks!</h1>

        </section>

        <section>
          <h1>Questions?</h1>
        </section>
      </div>

      <!-- The navigational controls UI -->
      <aside class="controls">
        <a class="left" href="#">&#x25C4;</a>
        <a class="right" href="#">&#x25BA;</a>
        <a class="up" href="#">&#x25B2;</a>
        <a class="down" href="#">&#x25BC;</a>
      </aside>

      <!-- Displays presentation progress, max value changes via JS to reflect # of slides -->
      <div class="progress"><span></span></div>

    </div>

    <!-- Optional libraries for code syntax highlighting and classList support in IE9 -->
    <script src="lib/highlight.js"></script>
    <script src="lib/classList.js"></script>
    <script src="lib/md5.js"></script>
    <script src="lib/carousel.js"></script>

    <script src="js/reveal.js"></script>

    <script>
      // Parse the query string into a key/value object
      var query = {};
      location.search.replace( /[A-Z0-9]+?=(\w*)/gi, function(a) {
        query[ a.split( '=' ).shift() ] = a.split( '=' ).pop();
      } );

      // Fires when a slide with data-state=customevent is activated
      Reveal.addEventListener( 'customevent', function() {
        alert( '"customevent" has fired' );
      } );

      // Fires each time a new slide is activated
      Reveal.addEventListener( 'slidechanged', function( event ) {
        // event.previousSlide, event.currentSlide, event.indexh, event.indexv
      } );

      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,

        // Display a presentation progress bar
        progress: true,

        // If true; each slide will be pushed to the browser history
        history: true,

        // Loops the presentation, defaults to false
        loop: false,

        // Flags if mouse wheel navigation should be enabled
        mouseWheel: true,

        // Apply a 3D roll to links on hover
        rollingLinks: true,

        // UI style
        theme: query.theme || 'default', // default/neon

        // Transition style
        transition: query.transition || 'default' // default/cube/page/concave/linear(2d)
      });

      hljs.initHighlightingOnLoad();
    </script>

    <!--

         .:77777777777777777777777777777777777777777777777777777777777777777777777777..
        .77777777777777777777777777777777777777777777777777777777777777777777777777777:.
        777777777777777777777777777777^777777777777777777777777777777777777777777777777?
        77777777777777777777777777777..77777777777777777777777/.......77777777777777777?
        777777777777777777777777777,...77777777777777777777...........77777777777777777?
        7777777777777777777777777I.....I77777777777777777....... +777777777777777777777?
        777777777777777777777777I......I7777777777777777,.....7I77777777777777777777777?
        77777777777777777777777+.......+7777777777777777.....?7777777777777777777777777?
        7777777777777777777777I.........777777777777777I.....77777777777777777777777777?
        777777777777777777777I..........777777777777777I.....77777777777777777777777777?
        777777777777777777777...........777777777777777I.....77777777777777777777777777?
        777777777777777777777...........777777777777777I.....77777777777777777777777777?
        77777777777777777777............777777777777777=.....77777777777777777777777777?
        7777777777777777777I............777777777777777......77777777777777777777777777?
        7777777777777777777.............77777777777777+.....777777777777777777777777777?
        7777777777777777777.............7777777777777..... 7777777777777777777777777777?
        7777777777777777777.............77777777I7,.......77777777777777777777777777777?
        777777777777777777..............777777........~77777777777777777777777777777777?
        777777777777777777..............777777.........~7777777777777777777777777777777?
        777777777777777777..............77777777777=......I7777777777777777777777777777?
        77777777777777777I..............77777777777777 .....777777777777777777777777777?
        77777777777777777~..............777777777777777.....?77777777777777777777777777?
        7777777777777777777777777I:.....777777777777777......77777777777777777777777777?
        777777777777777777777777777.....777777777777777?.....77777777777777777777777777?
        777777777777777777777777777..0..777777777777777I.....77777777777777777777777777?
        77777777777777777777777777I.....777777777777777I.....77777777777777777777777777?
        77777777777777777777777777?.....777777777777777I.....77777777777777777777777777?
        77777777777777777777777777I..0..777777777777777I.....77777777777777777777777777?
        777777777777777777777777777 ....7777777777777777.....,7777777777777777777777777?
        777777777777777777777777777.....7777777777777777?......I77777777777777777777777?
        7777777777777777777777777?..0...777777777777777777..........,,77777777777777777?
        7777777777777777777777777......77777777777777777777?..........77777777777777777?
        77777777777777777777777777+ ..77777777777777777777777777I?~:::77777777777777777?
        7777777777777777777777777777777777777777777777777777777777777777777777777777777?
        7777777777777777777777777777777777777777777777777777777777777777777777777777777?
        .777777777777777777777777777777777777777777777777777777777777777777777777777777.
         .:77777777777777777777777777777777777777777777777777777777777777777777777777:.

                                     http://fourkitchens.com
    -->
  </body>
</html>
